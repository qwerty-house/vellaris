<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #011445; -webkit-text-stroke: #4689cc; background-color: #000000; background-color: rgba(0, 0, 0, 0)}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #011445; -webkit-text-stroke: #4689cc; background-color: #000000; background-color: rgba(0, 0, 0, 0); min-height: 16.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en" class="dark"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;AI Image Editor&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Load Tailwind CSS --&gt;&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Load Inter font --&gt;&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Lucide icons --&gt;&lt;script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Custom styles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.glassmorphism {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: rgba(255, 255, 255, 0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>backdrop-filter: blur(10px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>-webkit-backdrop-filter: blur(10px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 1px solid rgba(255, 255, 255, 0.18);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-primary {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-lg transition-all duration-300 ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply hover:bg-blue-700 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-secondary {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply bg-gray-600 text-white font-medium py-3 px-6 rounded-lg shadow-lg transition-all duration-300 ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply hover:bg-gray-700 hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.btn-primary:disabled, .btn-secondary:disabled {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply bg-gray-400 cursor-not-allowed shadow-none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.image-selectable {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply rounded-lg cursor-pointer transition-all duration-300 border-4 border-transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.image-selectable:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply opacity-80;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.image-selectable.selected {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>@apply border-blue-500 shadow-2xl;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Spinner */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.loader {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 48px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 48px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 5px solid #FFF;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-bottom-color: #4f46e5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: inline-block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-sizing: border-box;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>animation: rotation 1s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>@keyframes rotation {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>0% { transform: rotate(0deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>100% { transform: rotate(360deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/* Modal */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#error-modal {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transition: opacity 0.3s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="max-w-6xl mx-auto"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Header --&gt;&lt;header class="text-center mb-8 md:mb-12"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>AI Image Editor</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="text-lg text-gray-300"&gt;Upload an image, describe your vision, and generate new creations.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Main Content Grid --&gt;&lt;div class="grid grid-cols-1 lg:grid-cols-2 gap-8"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Left Column: Input &amp; Controls --&gt;&lt;div class="flex flex-col space-y-6"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Step 1: Upload Image --&gt;&lt;div class="glassmorphism p-6 rounded-2xl shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold mb-4 flex items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;i data-lucide="upload" class="mr-2"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Step 1: Upload Your Image</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/h2&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="image-upload" class="block w-full h-64 border-2 border-dashed border-gray-400 rounded-lg cursor-pointer hover:border-blue-400 transition-colors duration-300"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div id="upload-prompt" class="flex flex-col items-center justify-center h-full text-gray-300"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;i data-lucide="cloud-upload" class="mb-2 w-12 h-12"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="font-medium"&gt;Click to upload or drag and drop&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm text-gray-400"&gt;PNG, JPG, or WEBP&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;img id="image-preview" src="#" alt="Image preview" class="w-full h-full object-contain rounded-lg hidden" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, image/webp"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Step 2: Write Prompt --&gt;&lt;div class="glassmorphism p-6 rounded-2xl shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold mb-4 flex items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;i data-lucide="text" class="mr-2"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Step 2: Describe Your Edit</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;textarea id="prompt-input" rows="4" class="w-full p-4 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 'Make this a watercolor painting', 'Change the background to a snowy mountain', 'Add a small red dragon on the shoulder'"&gt;&lt;/textarea&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Step 3: Generate --&gt;&lt;div class="glassmorphism p-6 rounded-2xl shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-2xl font-semibold mb-4 flex items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;i data-lucide="wand-2" class="mr-2"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Step 3: Generate &amp; Download</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex flex-col sm:flex-row gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="generate-button" class="btn-primary w-full flex items-center justify-center gap-2" disabled&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;i data-lucide="sparkles" class="inline-block w-5 h-5"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>Generate 4 Options</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="regenerate-button" class="btn-secondary w-full flex items-center justify-center gap-2" disabled&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;i data-lucide="refresh-cw" class="inline-block w-5 h-5"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>Regenerate</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;a id="download-button" class="btn-primary w-full mt-4 text-center hidden flex items-center justify-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;i data-lucide="download" class="inline-block w-5 h-5"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Download Selected</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/a&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Right Column: Output --&gt;&lt;div class="glassmorphism p-6 rounded-2xl shadow-lg min-h-[400px]"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-2xl font-semibold mb-4 text-center"&gt;Generated Images&lt;/h2&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Loading Spinner --&gt;&lt;div id="loading-spinner" class="flex flex-col items-center justify-center h-96 hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="loader"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-300 mt-4 text-lg font-medium"&gt;Generating your images... This may take a moment.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Initial Prompt --&gt;&lt;div id="output-placeholder" class="flex flex-col items-center justify-center h-96 text-gray-400"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;i data-lucide="image" class="mb-4 w-16 h-16 text-gray-500"&gt;&lt;/i&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-lg text-center"&gt;Your 4 generated images will appear here.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Image Grid --&gt;&lt;div id="image-grid" class="grid grid-cols-2 gap-4 hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img id="img-1" src="" alt="Generated image 1" class="image-selectable aspect-square object-cover" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img id="img-2" src="" alt="Generated image 2" class="image-selectable aspect-square object-cover" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img id="img-3" src="" alt="Generated image 3" class="image-selectable aspect-square object-cover" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img id="img-4" src="" alt="Generated image 4" class="image-selectable aspect-square object-cover" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Error Modal --&gt;&lt;div id="error-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md text-center border border-red-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 class="text-2xl font-bold text-red-400 mb-4"&gt;Error&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p id="error-message" class="text-gray-200 mb-6"&gt;Something went wrong.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="close-modal-button" class="btn-secondary px-8"&gt;Close&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Lucide Icons ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// This will find all elements with `data-lucide` and replace them with SVGs</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>lucide.createIcons();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// State variables</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let uploadedImageBase64 = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let uploadedMimeType = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let selectedImageUrl = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let isLoading = false;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// DOM Elements</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const imageUpload = document.getElementById('image-upload');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const imagePreview = document.getElementById('image-preview');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const uploadPrompt = document.getElementById('upload-prompt');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const promptInput = document.getElementById('prompt-input');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const generateButton = document.getElementById('generate-button');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const regenerateButton = document.getElementById('regenerate-button');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const downloadButton = document.getElementById('download-button');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const loadingSpinner = document.getElementById('loading-spinner');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const outputPlaceholder = document.getElementById('output-placeholder');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const imageGrid = document.getElementById('image-grid');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const gridImages = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('img-1'),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('img-2'),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('img-3'),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('img-4'),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Modal Elements</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const errorModal = document.getElementById('error-modal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const errorMessage = document.getElementById('error-message');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const closeModalButton = document.getElementById('close-modal-button');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Event Listeners ---</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>imageUpload.addEventListener('change', handleImageUpload);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>promptInput.addEventListener('input', checkInputs);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>generateButton.addEventListener('click', () =&gt; runGeneration()); // Changed to runGeneration without type</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>regenerateButton.addEventListener('click', () =&gt; runGeneration()); // Both buttons now call runGeneration</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>closeModalButton.addEventListener('click', hideErrorModal);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Add click listeners to grid images</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gridImages.forEach(img =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>img.addEventListener('click', () =&gt; selectImage(img));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Functions ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function handleImageUpload(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const file = event.target.files[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!file) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!['image/png', 'image/jpeg', 'image/webp'].includes(file.type)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>showErrorModal('Invalid file type. Please upload a PNG, JPG, or WEBP image.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>uploadedMimeType = file.type;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const reader = new FileReader();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>reader.onload = (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const fullBase64 = e.target.result;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>imagePreview.src = fullBase64;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>imagePreview.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>uploadPrompt.classList.add('hidden');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Store only the base64 data, without the prefix</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>uploadedImageBase64 = fullBase64.split(',')[1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>checkInputs();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>reader.onerror = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>showErrorModal('Failed to read the image file.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>resetUploadState();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>reader.readAsDataURL(file);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function checkInputs() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const hasImage = !!uploadedImageBase64;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const hasPrompt = promptInput.value.trim().length &gt; 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Enable/disable both generate and regenerate based on image and prompt</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (hasImage &amp;&amp; hasPrompt) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>generateButton.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>regenerateButton.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>generateButton.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>regenerateButton.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function resetUploadState() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>imagePreview.src = '#';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>imagePreview.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>uploadPrompt.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>imageUpload.value = ''; // Clear the file input</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>uploadedImageBase64 = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>uploadedMimeType = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>checkInputs();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function selectImage(selectedImg) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Remove 'selected' class from all images</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>gridImages.forEach(img =&gt; img.classList.remove('selected'));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Add 'selected' class to the clicked image</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>selectedImg.classList.add('selected');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>selectedImageUrl = selectedImg.src;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Update and show download button</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>downloadButton.href = selectedImageUrl;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>downloadButton.download = `generated-image-${Date.now()}.png`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>downloadButton.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function clearSelection() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>gridImages.forEach(img =&gt; img.classList.remove('selected'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>selectedImageUrl = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>downloadButton.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function runGeneration() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const prompt = promptInput.value.trim();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!uploadedImageBase64 || !prompt) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>showErrorModal('Please upload an image and write a prompt before generating.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setLoading(true);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Generate 4 images in parallel</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const generationPromises = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; 4; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>generationPromises.push(callImageApi(prompt, uploadedImageBase64, uploadedMimeType));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const results = await Promise.all(generationPromises);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Populate the grid</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>results.forEach((base64Data, index) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (base64Data &amp;&amp; gridImages[index]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>gridImages[index].src = `data:image/png;base64,${base64Data}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>console.error('Error generating images:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>showErrorModal(`Failed to generate images. ${error.message}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} finally {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>setLoading(false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function setLoading(state) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isLoading = state;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (state) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadingSpinner.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>imageGrid.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>outputPlaceholder.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>generateButton.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>regenerateButton.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>clearSelection();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadingSpinner.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>imageGrid.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>outputPlaceholder.classList.add('hidden'); // Keep placeholder hidden</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>checkInputs(); // Re-enable buttons</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>/**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>* Calls the Gemini API with exponential backoff.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function callImageApi(prompt, imageBase64, mimeType, maxRetries = 3) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const apiKey = ""; // API key will be injected</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payload = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>"contents": [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>"parts": [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>{ "text": prompt },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>"inlineData": {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>"mimeType": mimeType,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>"data": imageBase64</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>"generationConfig": {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>"responseModalities": ["TEXT", "IMAGE"]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let attempt = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>while (attempt &lt; maxRetries) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const response = await fetch(apiUrl, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>headers: { 'Content-Type': 'application/json' },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>body: JSON.stringify(payload)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (!response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const errorBody = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorBody.error?.message || 'Unknown error'}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const result = await response.json();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const part = result?.candidates?.[0]?.content?.parts?.find(p =&gt; p.inlineData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const base64Data = part?.inlineData?.data;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (!base64Data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>console.error("Invalid response structure:", result);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>throw new Error('No image data found in API response.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return base64Data; // Success</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>console.warn(`Attempt ${attempt + 1} failed: ${error.message}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>attempt++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (attempt &gt;= maxRetries) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>throw error; // Max retries reached</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>await new Promise(resolve =&gt; setTimeout(resolve, delay));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Modal Functions ---</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function showErrorModal(message) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>errorMessage.textContent = message;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>errorModal.classList.remove('opacity-0', 'pointer-events-none');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function hideErrorModal() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>errorModal.classList.add('opacity-0', 'pointer-events-none');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
</body>
</html>
